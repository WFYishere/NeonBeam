<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Decidophobia Helper</title>
    <!-- TagCloud library (CDN) -->
    <script src="https://unpkg.com/tagcloud.js@2.2.0/dist/TagCloud.min.js"></script>

    <style>
      body {
        font-family: sans-serif;
        text-align: center;
      }
      #cloud-container {
        width: 400px;
        height: 400px;
        margin: 20px auto;
        position: relative;
        border: 1px solid #ddd;
      }
      #chosenOption {
        margin-top: 20px;
        font-weight: bold;
        font-size: 1.2em;
      }
    </style>
  </head>

  <body>
    <h1>Decidophobia</h1>

    <input id="userInput" type="text" placeholder="What should I do?" style="width: 300px;" />
    <button id="askBtn">Ask LLM</button>

    <div id="cloud-container"></div>
    <div id="chosenOption"></div>

    <script>
      const apiEndpoint = "/api/llm";

      document.getElementById("askBtn").addEventListener("click", async () => {
        const userPrompt = document.getElementById("userInput").value.trim();
        if (!userPrompt) return;

        const suggestions = await getSuggestions(userPrompt);

        displayTagCloud(suggestions);

        pickRandomSuggestion(suggestions);
      });

      async function getSuggestions(prompt) {
        try {
          const response = await fetch(apiEndpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ prompt }), // sending { prompt: "..." }
          });

          const data = await response.json();
          if (!data.suggestions) return [];

          // "dimsum, rice, beef..."
          const arr = data.suggestions.split(",").map((i) => i.trim()).filter(Boolean);
          return arr;
        } catch (error) {
          console.error("Error fetching suggestions:", error);
          return [];
        }
      }

      function displayTagCloud(wordsArray) {
        // Clear old cloud
        document.getElementById("cloud-container").innerHTML = "";

        if (!wordsArray.length) {
          // If no suggestions found
          document.getElementById("cloud-container").innerText = "No suggestions found.";
          return;
        }

        TagCloud("#cloud-container", wordsArray, {
          radius: 150,
          maxSpeed: "fast",
          initSpeed: "normal",
          direction: 135,
          keep: true,
        });
      }

      // Random pick
      function pickRandomSuggestion(suggestions) {
        if (!suggestions.length) {
          document.getElementById("chosenOption").textContent = "";
          return;
        }
        const randomIndex = Math.floor(Math.random() * suggestions.length);
        const chosen = suggestions[randomIndex];
        document.getElementById("chosenOption").textContent = `Random Suggestion: ${chosen}`;
      }
    </script>
  </body>
</html>
